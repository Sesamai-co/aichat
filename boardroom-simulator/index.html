<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Boardroom Simulator | Executive Presence Coach</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* --- CHARCOAL & GOLD PALETTE --- */
            --bg-dark: #121212; 
            --bg-gradient: radial-gradient(circle at 50% 0%, #2a2a2a 0%, #121212 80%);
            --glass-surface: rgba(30, 30, 30, 0.95);
            --glass-border: rgba(255, 255, 255, 0.1);
            --gold-accent: #eab308; 
            --gold-glow: rgba(234, 179, 8, 0.15);
            --text-primary: #ffffff;
            --text-secondary: #a3a3a3;
            --success: #10b981;
            --danger: #ef4444;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-gradient);
            color: var(--text-primary);
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* --- HEADER --- */
        header {
            background: rgba(18, 18, 18, 0.98);
            border-bottom: 1px solid var(--glass-border);
            padding: 0 2rem;
            height: 70px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
        }

        .brand { display: flex; align-items: center; gap: 12px; }
        .brand-logo { font-size: 1.5rem; filter: drop-shadow(0 0 8px var(--gold-glow)); }
        .brand-text h1 {
            font-family: 'Playfair Display', serif;
            font-size: 1.1rem; margin: 0; letter-spacing: 0.5px;
            background: linear-gradient(45deg, #fff, #bbb);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .brand-text p { font-size: 0.65rem; color: var(--text-secondary); margin: 0; text-transform: uppercase; letter-spacing: 2px; }

        .header-controls {
            display: flex; align-items: center; gap: 15px;
            background: rgba(255,255,255,0.03); padding: 6px 12px; border-radius: 40px; border: 1px solid var(--glass-border);
        }

        .mode-toggle { display: flex; background: rgba(0,0,0,0.3); border-radius: 20px; padding: 3px; cursor: pointer; }
        .mode-option { padding: 5px 12px; border-radius: 16px; font-size: 0.75rem; font-weight: 600; color: var(--text-secondary); transition: 0.2s; }
        .mode-option.active { background: var(--text-primary); color: var(--bg-dark); }

        .api-input {
            background: transparent; border: none; color: var(--text-primary); font-family: monospace;
            width: 100px; outline: none; font-size: 0.8rem; transition: width 0.3s;
        }
        .api-input:focus { width: 220px; }
        .api-input::placeholder { color: var(--text-secondary); opacity: 0.5; }

        /* --- MAIN --- */
        main {
            flex: 1; display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; padding: 2rem;
            max-width: 1600px; margin: 0 auto; width: 100%; box-sizing: border-box;
        }

        .glass-panel {
            background: var(--glass-surface);
            border: 1px solid var(--glass-border);
            border-radius: 12px; padding: 2rem;
            display: flex; flex-direction: column; position: relative;
            box-shadow: 0 20px 50px -20px rgba(0,0,0,0.7);
        }

        h2 {
            font-family: 'Playfair Display', serif; color: var(--gold-accent); font-size: 1rem; margin: 0 0 1.5rem 0;
            display: flex; justify-content: space-between; align-items: center; text-transform: uppercase; letter-spacing: 1px;
        }

        .refresh-btn {
            background: transparent; border: 1px solid var(--glass-border); color: var(--text-secondary);
            border-radius: 50%; width: 28px; height: 28px; cursor: pointer; transition: 0.3s;
            display: flex; align-items: center; justify-content: center;
        }
        .refresh-btn:hover { border-color: var(--gold-accent); color: var(--gold-accent); transform: rotate(180deg); }

        /* Scenario */
        .scenario-box {
            background: linear-gradient(90deg, rgba(234, 179, 8, 0.08) 0%, rgba(0,0,0,0) 100%);
            border-left: 3px solid var(--gold-accent); padding: 1.2rem; border-radius: 0 6px 6px 0; margin-bottom: 1.5rem;
        }
        .scenario-text { font-size: 1rem; line-height: 1.5; font-weight: 300; }

        /* Transcript - FORCED HIGH CONTRAST */
        .transcript-wrapper {
            flex: 1; background: #000000; border-radius: 8px; padding: 1.5rem;
            font-family: 'Inter', monospace; line-height: 1.6; overflow-y: auto;
            border: 1px solid var(--glass-border); margin-bottom: 2rem;
            color: #ffffff; /* FORCE WHITE TEXT */
        }
        .transcript-final { color: #ffffff; font-weight: 400; }
        .transcript-interim { color: #888888; font-style: italic; }

        /* Controls */
        .action-bar { display: grid; grid-template-columns: 2fr 1fr; gap: 1rem; }
        .btn { padding: 1rem; border-radius: 6px; font-weight: 600; letter-spacing: 0.5px; cursor: pointer; border: none; text-transform: uppercase; font-size: 0.8rem; transition: 0.2s; }
        
        .btn-record { background: var(--text-primary); color: var(--bg-dark); display: flex; align-items: center; justify-content: center; gap: 10px; }
        .btn-record:hover { background: #e2e2e2; }
        .btn-record.recording { background: var(--danger); color: white; animation: pulse 2s infinite; }
        
        .btn-analyze { background: transparent; border: 1px solid var(--glass-border); color: var(--text-secondary); cursor: not-allowed; }
        .btn-analyze.ready { background: var(--gold-accent); color: var(--bg-dark); border-color: var(--gold-accent); cursor: pointer; font-weight: 700; }

        /* Dashboard */
        .dashboard-empty { height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; color: var(--text-secondary); opacity: 0.4; text-align: center; }
        .dashboard-content { display: none; height: 100%; flex-direction: column; }
        .dashboard-content.visible { display: flex; }

        .metrics-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 2rem; }
        .metric-card { background: rgba(255,255,255,0.03); border-radius: 8px; padding: 1.5rem; text-align: center; border: 1px solid var(--glass-border); }
        .metric-val { font-size: 3rem; font-family: 'Playfair Display', serif; font-weight: 700; line-height: 1; margin-bottom: 0.5rem; color: var(--text-primary); }
        .metric-label { font-size: 0.65rem; text-transform: uppercase; color: var(--text-secondary); letter-spacing: 1.5px; }

        .feedback-section { flex: 1; overflow-y: auto; }
        .feedback-label { color: var(--gold-accent); font-size: 0.7rem; font-weight: 700; text-transform: uppercase; margin-bottom: 0.5rem; display: block; }
        .rewrite-box { background: rgba(16, 185, 129, 0.08); border-left: 2px solid var(--success); padding: 1rem; font-style: italic; color: #a7f3d0; line-height: 1.5; margin-top: 5px; }

        .status-pill { position: absolute; top: 1.5rem; right: 2rem; font-size: 0.7rem; color: var(--text-secondary); background: rgba(255,255,255,0.05); padding: 4px 10px; border-radius: 20px; }
        .loader { display: none; flex-direction: column; align-items: center; justify-content: center; height: 100%; }
        .loader.visible { display: flex; }
        .spinner { width: 30px; height: 30px; border: 2px solid rgba(255,255,255,0.1); border-radius: 50%; border-top-color: var(--gold-accent); animation: spin 1s infinite; margin-bottom: 1rem; }

        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }
        @keyframes spin { 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <header>
        <div class="brand">
            <div class="brand-logo">üéôÔ∏è</div>
            <div class="brand-text">
                <h1>Boardroom Simulator</h1>
                <p>Executive Communication Coach</p>
            </div>
        </div>
        <div class="header-controls">
            <div class="mode-toggle">
                <div class="mode-option active" id="mode-demo" onclick="setMode('demo')">DEMO</div>
                <div class="mode-option" id="mode-live" onclick="setMode('live')">LIVE</div>
            </div>
            <div id="api-wrapper" style="display: none; border-left: 1px solid rgba(255,255,255,0.1); padding-left: 10px; margin-left: 10px;">
                <input type="password" id="api-key" class="api-input" placeholder="OpenAI Key..." oninput="saveKey()">
            </div>
        </div>
    </header>

    <main>
        <div class="glass-panel">
            <h2>Scenario Context <button class="refresh-btn" onclick="generateScenario()">‚Üª</button></h2>
            <div class="scenario-box">
                <div class="scenario-text" id="scenario-text">Initializing Crisis...</div>
            </div>

            <div class="transcript-wrapper" id="transcript">
                <span style="color: #666;">// Press Record to begin speaking...</span>
            </div>

            <div class="action-bar">
                <button id="btn-record" class="btn btn-record" onclick="toggleMic()">
                    <span id="mic-icon">‚óè</span> <span id="mic-text">START RECORDING</span>
                </button>
                <button id="btn-analyze" class="btn btn-analyze" onclick="analyze()" disabled>ANALYZE</button>
            </div>
            <div class="status-pill" id="status-text">System Ready</div>
        </div>

        <div class="glass-panel">
            <h2>Executive Feedback</h2> 

            <div id="state-empty" class="dashboard-empty">
                <div style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.3;">üìä</div>
                <p>Awaiting transcript analysis...</p>
            </div>

            <div id="state-loading" class="loader">
                <div class="spinner"></div>
                <p style="color: var(--gold-accent); font-size: 0.8rem; letter-spacing: 1px;">EVALUATING...</p>
            </div>

            <div id="state-dash" class="dashboard-content">
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-val" id="score-val">--</div>
                        <div class="metric-label">Brevity</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-val" id="grade-val">--</div>
                        <div class="metric-label">Impact</div>
                    </div>
                </div>

                <div class="feedback-section">
                    <div style="margin-bottom: 1.5rem;">
                        <span class="feedback-label">Critique</span>
                        <div id="feedback-text" style="line-height: 1.6; color: var(--text-primary);">--</div>
                    </div>
                    <div>
                        <span class="feedback-label">Executive Rewrite (BLUF)</span>
                        <div id="rewrite-text" class="rewrite-box">--</div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // --- APP LOGIC ---
        const App = {
            mode: 'demo',
            apiKey: localStorage.getItem('boardroom_api_key') || '',
            isRecording: false,
            recognition: null,
            scenario: "",
            finalTranscript: "",
            interimTranscript: "" 
        };

        const SCENARIOS = [
            "The database migration failed, causing 4 hours of downtime for EU customers.",
            "We are projecting a $50k overage on cloud costs due to autoscaling errors.",
            "The Lead Engineer on Project Alpha has resigned effectively immediately.",
            "A security audit revealed a vulnerability in our login flow."
        ];

        document.addEventListener('DOMContentLoaded', () => {
            generateScenario();
            setupSpeech();
            if(App.apiKey && App.apiKey.startsWith('sk-')) {
                document.getElementById('api-key').value = App.apiKey;
                setMode('live');
            }
        });

        // --- SPEECH RECOGNITION ---
        function setupSpeech() {
            if(!('webkitSpeechRecognition' in window)) {
                document.getElementById('transcript').innerHTML = "<span style='color:var(--danger)'>‚ö†Ô∏è Browser not supported. Use Chrome Desktop.</span>";
                return;
            }

            App.recognition = new webkitSpeechRecognition();
            App.recognition.continuous = true; 
            App.recognition.interimResults = true; 
            App.recognition.lang = 'en-US';

            App.recognition.onstart = () => {
                updateStatus("Microphone Active");
            };

            App.recognition.onresult = (event) => {
                let interim = "";
                for (let i = event.resultIndex; i < event.results.length; ++i) {
                    if (event.results[i].isFinal) {
                        App.finalTranscript += event.results[i][0].transcript;
                    } else {
                        interim += event.results[i][0].transcript;
                    }
                }
                
                // FORCE UPDATE DOM
                const display = `<span class="transcript-final">${App.finalTranscript}</span> <span class="transcript-interim">${interim}</span>`;
                document.getElementById('transcript').innerHTML = display;
                
                // Auto-scroll to bottom
                const container = document.getElementById('transcript');
                container.scrollTop = container.scrollHeight;

                // Enable button
                if((App.finalTranscript + interim).length > 5) {
                    const btn = document.getElementById('btn-analyze');
                    btn.disabled = false;
                    btn.classList.add('ready');
                }
            };

            // FIX: Auto-Restart Logic
            App.recognition.onend = () => {
                if (App.isRecording) {
                    console.log("Browser stopped mic. Restarting...");
                    try {
                        App.recognition.start();
                    } catch(e) { stopMicUI(); }
                } else {
                    updateStatus("Recording Stopped");
                }
            };

            App.recognition.onerror = (e) => {
                console.error("Mic Error:", e.error);
                if (e.error === 'not-allowed') {
                    updateStatus("‚ùå Mic Permission Denied");
                    stopMicUI();
                }
            };
        }

        function toggleMic() {
            if(!App.isRecording) {
                // START
                App.finalTranscript = "";
                App.interimTranscript = "";
                document.getElementById('transcript').innerHTML = "";
                
                try {
                    App.recognition.start();
                    App.isRecording = true;
                    
                    const btn = document.getElementById('btn-record');
                    btn.classList.add('recording');
                    document.getElementById('mic-text').innerText = "STOP";
                    document.getElementById('mic-icon').innerText = "‚ñ†";
                    
                    const analyzeBtn = document.getElementById('btn-analyze');
                    analyzeBtn.disabled = true;
                    analyzeBtn.classList.remove('ready');
                } catch(e) {
                    alert("Could not start mic. Check permissions.");
                }

            } else {
                // STOP
                App.isRecording = false; 
                App.recognition.stop();
                stopMicUI();
            }
        }

        function stopMicUI() {
            App.isRecording = false;
            const btn = document.getElementById('btn-record');
            btn.classList.remove('recording');
            document.getElementById('mic-text').innerText = "START RECORDING";
            document.getElementById('mic-icon').innerText = "‚óè";
        }

        // --- ANALYSIS ---
        async function analyze() {
            if(App.isRecording) toggleMic(); 

            const text = document.getElementById('transcript').innerText;
            if(text.length < 5 || text.includes("// Press Record")) {
                alert("Please speak first.");
                return;
            }

            document.getElementById('state-empty').style.display = 'none';
            document.getElementById('state-dash').classList.remove('visible');
            document.getElementById('state-loading').classList.add('visible');
            updateStatus("Analyzing...");

            try {
                let data;
                if(App.mode === 'live' && App.apiKey.length > 10) {
                    data = await callOpenAI(text);
                } else {
                    await new Promise(r => setTimeout(r, 1500));
                    data = getMockData();
                }
                renderDashboard(data);
                updateStatus("Complete");

            } catch(e) {
                alert("Error: " + e.message);
                document.getElementById('state-loading').classList.remove('visible');
                document.getElementById('state-empty').style.display = 'flex';
            }
        }

        async function callOpenAI(text) {
            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${App.apiKey}`
                },
                body: JSON.stringify({
                    model: "gpt-4o-mini",
                    messages: [
                        {role: "system", content: "You are a ruthless CFO. Output valid JSON: {brevity_score: number, grade: string, feedback: string, rewrite: string}."},
                        {role: "user", content: `Context: ${App.scenario}. Transcript: ${text}`}
                    ],
                    response_format: { type: "json_object" }
                })
            });
            if(!response.ok) throw new Error("OpenAI API Failure");
            const json = await response.json();
            return JSON.parse(json.choices[0].message.content);
        }

        function getMockData() {
            return {
                brevity_score: 45,
                grade: "C-",
                feedback: "(DEMO) You buried the lead. I don't care about the process, I care about the timeline impact.",
                rewrite: "Project is delayed by 2 weeks. Mitigation plan attached."
            };
        }

        // --- UTILS ---
        function setMode(mode) {
            App.mode = mode;
            document.getElementById('mode-demo').classList.toggle('active', mode === 'demo');
            document.getElementById('mode-live').classList.toggle('active', mode === 'live');
            document.getElementById('api-wrapper').style.display = mode === 'live' ? 'block' : 'none';
        }

        function saveKey() {
            const key = document.getElementById('api-key').value.trim();
            App.apiKey = key;
            localStorage.setItem('boardroom_api_key', key);
        }

        function generateScenario() {
            const random = SCENARIOS[Math.floor(Math.random() * SCENARIOS.length)];
            App.scenario = random;
            document.getElementById('scenario-text').innerText = random;
            document.getElementById('state-dash').classList.remove('visible');
            document.getElementById('state-empty').style.display = 'flex';
        }

        function updateStatus(msg) {
            document.getElementById('status-text').innerText = msg;
        }
    </script>
</body>
</html>